<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê°•ë¦‰ì•„ì‚°ë³‘ì› ì•ˆë‚´ì§€ë„ v14</title>

<!-- í•µì‹¬ ì¸µ ë¯¸ë¦¬ ë¡œë“œ (ì†ë„ ê°œì„ ) -->
<link rel="preload" as="image" href="https://i0.wp.com/i.ibb.co/99nBTF5r/1.png">
<link rel="preload" as="image" href="https://i0.wp.com/i.ibb.co/SwCtCF4c/2.png">
<link rel="preload" as="image" href="https://i0.wp.com/i.ibb.co/nqZHRSS8/3.png">
<link rel="preload" as="image" href="https://i0.wp.com/i.ibb.co/v4kHJDPV/2.png">
<link rel="preload" as="image" href="https://i0.wp.com/i.ibb.co/MxkY0q1f/3.png">

<style>
  body{
    font-family:'Pretendard',sans-serif;
    text-align:center;
    background:#fafafa;
    color:#333;
    padding:32px 16px 80px;
  }
  h1{
    color:#009688;
    font-weight:600;
    font-size:24px;
    margin-bottom:6px;
  }
  .subtitle{
    color:#555;
    font-size:15px;
    margin-bottom:24px;
  }

  .search-area{
    max-width:700px;
    width:100%;
    margin:0 auto 24px auto;
    text-align:left;
    background:#fff;
    border-radius:16px;
    box-shadow:0 4px 14px rgba(0,0,0,0.06);
    border:1px solid #ddd;
    padding:20px 24px;
    position:relative;
  }

  .field-label{
    font-size:14px;
    font-weight:500;
    color:#444;
    margin-bottom:6px;
    display:block;
  }

  .input-wrap{
    position:relative;
    width:100%;
    margin-bottom:16px;
  }

  input[type="text"]{
    width:100%;
    padding:14px;
    border:1px solid #ccc;
    border-radius:10px;
    font-size:16px;
    box-sizing:border-box;
  }

  button.main-btn{
    width:100%;
    padding:12px 30px;
    background:#ff8c42;
    color:#fff;
    border:none;
    border-radius:10px;
    font-size:16px;
    font-weight:600;
    cursor:pointer;
    transition:0.3s;
  }
  button.main-btn:hover{
    transform:scale(1.05);
    background:#ff9e63;
  }

  .section-title{
    font-size:16px;
    font-weight:600;
    margin-top:12px;
    margin-bottom:6px;
    color:#444;
  }

  /* ì¶”ì²œ ìë™ì™„ì„± ë°•ìŠ¤ */
  .suggest-box{
    display:none;
    position:absolute;
    left:0;
    right:0;
    top:100%;
    margin-top:6px;
    background:#fff7f2;
    border:1px solid #ff9e63;
    border-radius:12px;
    box-shadow:0 4px 12px rgba(255,140,66,0.35);
    padding:12px 14px;
    z-index:50;
  }
  .suggest-header{
    font-size:13px;
    font-weight:600;
    color:#ff8c42;
    margin-bottom:8px;
    display:flex;
    align-items:center;
    gap:4px;
  }
  .suggest-list{
    max-height:200px;
    overflow-y:auto;
  }
  .suggest-item{
    font-size:14px;
    line-height:1.4;
    color:#444;
    background:#ffffff00;
    border-radius:8px;
    padding:8px 10px;
    cursor:pointer;
  }
  .suggest-item b{
    color:#000;
    font-weight:600;
  }
  .suggest-item small{
    color:#666;
    font-size:12px;
    display:block;
    margin-top:2px;
  }
  .suggest-item:hover{
    background:#ffb580;
    color:#000;
  }

  /* ì§€ë„ ì»¨í…Œì´ë„ˆ */
  #mapsContainer{
    max-width:1200px;
    width:100%;
    margin:32px auto 0 auto;
    display:none;
  }

  .map-block{
    margin-bottom:32px;
  }
  .map-heading{
    font-size:17px;
    font-weight:600;
    margin-bottom:10px;
  }
  .map-heading.current{
    color:#009688;
  }
  .map-heading.dest{
    color:#ff8c42;
  }

  .map-wrapper{
    position:relative;
    display:inline-block;
    width:100%;
    max-width:1200px;
  }
  .floor-map{
    width:100%;
    height:auto;
    border-radius:12px;
    box-shadow:0 3px 10px rgba(0,0,0,0.3);
    cursor:pointer;
    display:block;
  }

  /* ë§ˆì»¤ */
  @keyframes blink {
    0%{opacity:1;}
    50%{opacity:0.4;}
    100%{opacity:1;}
  }
  .marker{
    position:absolute;
    border-radius:50%;
    animation:blink 1s infinite;
    z-index:10;
  }
  .marker.start{
    width:22px;
    height:22px;
    background:#4caf50;
    box-shadow:0 0 0 6px rgba(76,175,80,0.2);
  }
  .marker.end{
    width:26px;
    height:26px;
    background:#ff8c42;
    box-shadow:0 0 0 6px rgba(255,140,66,0.2);
  }
  .marker.elevator{
    width:22px;
    height:22px;
    background:#b87333; /* êµ¬ë¦¬ìƒ‰ */
    box-shadow:0 0 0 6px rgba(184,115,51,0.25);
  }

  #message{
    white-space:pre-line;
    margin-top:16px;
    font-size:15px;
    line-height:1.5;
    color:#666;
  }

  /* í™•ëŒ€ íŒì—… */
  #imagePopup{
    display:none;
    position:fixed;
    top:0;left:0;
    width:100%;height:100%;
    background:rgba(0,0,0,.8);
    justify-content:center;
    align-items:center;
    z-index:1000;
  }
  #popupInner{
    position:relative;
    max-width:95%;
    max-height:95%;
  }
  #popupClose{
    position:absolute;
    top:-44px;
    right:-10px;
    background:#ff8c42;
    border:none;
    color:#fff;
    font-size:22px;
    padding:8px 14px;
    border-radius:8px;
    cursor:pointer;
  }
  #popupImg{
    max-width:100%;
    max-height:90vh;
    border-radius:12px;
    box-shadow:0 5px 15px rgba(0,0,0,0.4);
  }

  /* ë¡œë”© ì˜¤ë²„ë ˆì´ */
  #loadingOverlay{
    position:fixed;
    top:0;left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.6);
    color:#fff;
    display:none;
    align-items:center;
    justify-content:center;
    text-align:center;
    z-index:2000;
    font-size:16px;
    line-height:1.5;
    padding:20px;
  }
  #loadingBox{
    background:rgba(0,0,0,0.75);
    border-radius:12px;
    padding:20px 24px;
    max-width:260px;
    box-shadow:0 6px 16px rgba(0,0,0,0.5);
    border:1px solid rgba(255,255,255,0.2);
  }
  #loadingBox p{
    color:#fff;
    margin:0;
    font-weight:500;
  }
</style>
</head>
<body>

<h1>ê°•ë¦‰ì•„ì‚°ë³‘ì›</h1>
<p class="subtitle">ì°¾ê³  ì‹¶ì€ ì§„ë£Œê³¼/ê²€ì‚¬ì‹¤ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. ğŸ¥</p>

<!-- ê²€ìƒ‰ ì˜ì—­ -->
<div class="search-area">
  <!-- ì¶œë°œì§€ -->
  <span class="field-label">ì¶œë°œì§€</span>
  <div class="input-wrap">
    <input id="startInput" type="text"
      placeholder="ì˜ˆ: ì‹ ê²½ê³¼, CTì‹¤"
      oninput="showSuggestions('start')">
    <div id="startSuggest" class="suggest-box">
      <div class="suggest-header">ğŸ’¡ í˜¹ì‹œ ì´ëŸ° ê³³ ì°¾ìœ¼ì…¨ë‚˜ìš”?</div>
      <div class="suggest-list" id="startSuggestList"></div>
    </div>
  </div>

  <!-- ë„ì°©ì§€ -->
  <span class="field-label" style="margin-top:8px;display:block;">ë„ì°©ì§€</span>
  <div class="input-wrap">
    <input id="endInput" type="text"
      placeholder="ì˜ˆ: MRIì‹¤, ì‹¬ì¥ë‚´ê³¼"
      oninput="showSuggestions('end')">
    <div id="endSuggest" class="suggest-box">
      <div class="suggest-header">ğŸ’¡ í˜¹ì‹œ ì´ëŸ° ê³³ ì°¾ìœ¼ì…¨ë‚˜ìš”?</div>
      <div class="suggest-list" id="endSuggestList"></div>
    </div>
  </div>

  <button class="main-btn" style="margin-top:10px;" onclick="navigateRoute()">ğŸ§­ ê²½ë¡œ ì•ˆë‚´</button>

  <div class="section-title" style="margin-top:20px;">ë¹ ë¥¸ ìœ„ì¹˜ ì°¾ê¸° (ë„ì°©ì§€ë§Œ ë³´ê³  ì‹¶ì„ ë•Œ)</div>
  <div class="input-wrap">
    <input id="searchInput" type="text"
      placeholder="ì˜ˆ: ë‚´ë¶„ë¹„ë‚´ê³¼, ì´ˆìŒíŒŒê²€ì‚¬ì‹¤"
      oninput="showSuggestions('search')"
      onkeydown="if(event.key==='Enter') searchPlace();">
    <div id="searchSuggest" class="suggest-box">
      <div class="suggest-header">ğŸ’¡ í˜¹ì‹œ ì´ëŸ° ê³³ ì°¾ìœ¼ì…¨ë‚˜ìš”?</div>
      <div class="suggest-list" id="searchSuggestList"></div>
    </div>
  </div>
  <button class="main-btn" onclick="searchPlace()">ğŸ” ìœ„ì¹˜ í‘œì‹œ</button>
</div>

<!-- ì§€ë„ ì˜ì—­ -->
<div id="mapsContainer">
  <div id="currentBlock" class="map-block">
    <div class="map-heading current">í˜„ì¬ ìœ„ì¹˜ (ì¶œë°œì¸µ)</div>
    <div id="mapCurrent" class="map-wrapper">
      <img id="mapImageCurrent" class="floor-map" src="" alt="ì¶œë°œì¸µ ì§€ë„" loading="lazy" onclick="openImagePopup(this.src)">
    </div>
  </div>

  <div id="destBlock" class="map-block">
    <div class="map-heading dest">ë„ì°© ìœ„ì¹˜ (ë„ì°©ì¸µ)</div>
    <div id="mapDestination" class="map-wrapper">
      <img id="mapImageDestination" class="floor-map" src="" alt="ë„ì°©ì¸µ ì§€ë„" loading="lazy" onclick="openImagePopup(this.src)">
    </div>
  </div>
</div>

<p id="message"></p>

<!-- í™•ëŒ€ íŒì—… -->
<div id="imagePopup" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
 background:rgba(0,0,0,0.85); z-index:5000; align-items:center; justify-content:center;">

  <div id="popupInner" style="position:relative; max-width:95%; max-height:95%;">
    <button id="popupClose" onclick="closeImagePopup()"
      style="position:absolute; top:-44px; right:-10px; background:#ff8c42; border:none;
      color:#fff; font-size:22px; padding:8px 14px; border-radius:8px; cursor:pointer;">
      âœ•
    </button>

    <!-- ì§€ë„ ì´ë¯¸ì§€ + ë§ˆì»¤ ê°™ì´ í‘œì‹œ -->
    <div id="popupImgWrap" style="position:relative; max-width:100%; max-height:90vh;">
      <img id="popupImg" src="" style="max-width:100%; max-height:90vh; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.4);">
      <div id="popupMarker" class="marker end"
        style="display:none; position:absolute; width:26px; height:26px; border-radius:50%;
        background:#ff8c42; box-shadow:0 0 0 6px rgba(255,140,66,0.2);
        animation:blink 1s infinite; z-index:5010;"></div>
    </div>
  </div>
</div>

<!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
<div id="loadingOverlay">
  <div id="loadingBox">
    <p>ì§€ë„ê°€ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤.<br>ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš” ğŸ™‡</p>
  </div>
</div>

<script>
/* ---- ì§€ë„ ì´ë¯¸ì§€ URL (i0.wp.com í”„ë¡ì‹œë¡œ ë¹ ë¥´ê²Œ) ---- */
const maps = {
  'ë³¸ê´€ ì§€í•˜1ì¸µ': 'https://i0.wp.com/i.ibb.co/99nBTF5r/1.png',
  'ë³¸ê´€ 2ì¸µ':     'https://i0.wp.com/i.ibb.co/SwCtCF4c/2.png',
  'ë³¸ê´€ 3ì¸µ':     'https://i0.wp.com/i.ibb.co/nqZHRSS8/3.png',
  'ì‹ ê´€ ì§€í•˜1ì¸µ': 'https://i0.wp.com/i.ibb.co/JFp1QW6S/1.png',
  'ì‹ ê´€ 1ì¸µ':     'https://i0.wp.com/i.ibb.co/7dLZNF41/1.png',
  'ì‹ ê´€ 2ì¸µ':     'https://i0.wp.com/i.ibb.co/v4kHJDPV/2.png',
  'ì‹ ê´€ 3ì¸µ':     'https://i0.wp.com/i.ibb.co/MxkY0q1f/3.png'
};

/* ---- ì—˜ë¦¬ë² ì´í„° ì¢Œí‘œ ---- */
const elevators = {
  'ë³¸ê´€ ì§€í•˜1ì¸µ': {top:'65.2%', left:'46.4%'},
  'ë³¸ê´€ 2ì¸µ':     {top:'32%',   left:'45.5%'},
  'ë³¸ê´€ 3ì¸µ':     {top:'56%',   left:'46.4%'},
  'ì‹ ê´€ ì§€í•˜1ì¸µ': {top:'62.5%', left:'20.2%'},
  'ì‹ ê´€ 1ì¸µ':     {top:'61.4%', left:'14.1%'},
  'ì‹ ê´€ 2ì¸µ':     {top:'69.9%', left:'33.1%'},
  'ì‹ ê´€ 3ì¸µ':     {top:'65.8%', left:'36%'}
};

/* ---- ì „ì²´ ìœ„ì¹˜ ì¢Œí‘œ ---- */
const positions = {
  // ë³¸ê´€ ì§€í•˜ 1ì¸µ
  'ë°©ì‚¬ì„ ì¢…ì–‘í•™ê³¼': {floor:'ë³¸ê´€ ì§€í•˜1ì¸µ', top:'30.6%', left:'25.3%'},

  // ë³¸ê´€ 2ì¸µ
  'ì†Œí™”ê¸°ë³‘ì„¼í„°':          {floor:'ë³¸ê´€ 2ì¸µ', top:'27.9%', left:'10%'},
  'ì´ˆìŒíŒŒê²€ì‚¬ì‹¤':          {floor:'ë³¸ê´€ 2ì¸µ', top:'12%', left:'50.1%'},
  'ì†Œì•„ì§„ì •ì‹¤':            {floor:'ë³¸ê´€ 2ì¸µ', top:'21.9%', left:'28.7%'},
  'í•µì˜í•™ê³¼(ê°ë§ˆì˜ìƒì‹¤)':  {floor:'ë³¸ê´€ 2ì¸µ', top:'17.8%', left:'55.9%'},
  'ì¬í™œì˜í•™ê³¼(ë³¸ê´€2ì¸µ)':   {floor:'ë³¸ê´€ 2ì¸µ', top:'20.5%', left:'86.8%'},
  'í˜ˆê´€ì¡°ì˜ì‹¤':            {floor:'ë³¸ê´€ 2ì¸µ', top:'43.8%', left:'17.3%'},
  'ë‡Œì‹ ê²½ê²€ì‚¬ì‹¤':          {floor:'ë³¸ê´€ 2ì¸µ', top:'41.8%', left:'6.3%'},
  'ctì‹¤':                  {floor:'ë³¸ê´€ 2ì¸µ', top:'47.2%', left:'38.4%'},
  'mriì‹¤':                 {floor:'ë³¸ê´€ 2ì¸µ', top:'47.2%', left:'38.4%'},
  'ëŒ€ê¸°ì‹¤':                {floor:'ë³¸ê´€ 2ì¸µ', top:'47.9%', left:'46.9%'},
  'ì˜ìƒì˜í•™ê³¼ ì ‘ìˆ˜':       {floor:'ë³¸ê´€ 2ì¸µ', top:'44.5%', left:'60.1%'},
  'ì¼ë°˜ì´¬ì˜ì‹¤':            {floor:'ë³¸ê´€ 2ì¸µ', top:'56.4%', left:'69.1%'},
  'íˆ¬ì‹œì´¬ì˜ì‹¤':            {floor:'ë³¸ê´€ 2ì¸µ', top:'44.2%', left:'70.8%'},
  'ct3':                   {floor:'ë³¸ê´€ 2ì¸µ', top:'70.9%', left:'71.3%'},
  'í•­ì•” ë‚®ë³‘ë™':           {floor:'ë³¸ê´€ 2ì¸µ', top:'86.8%', left:'68.3%'},
  'ë‹¤í•™ì œ ì§„ë£Œì‹¤':         {floor:'ë³¸ê´€ 2ì¸µ', top:'79.7%', left:'46.9%'},

  // ë³¸ê´€ 3ì¸µ
  'í˜¸í¡ê¸°ë‚´ê³¼':                {floor:'ë³¸ê´€ 3ì¸µ', top:'30.6%', left:'16.5%'},
  'ì¬í™œì˜í•™ê³¼':                {floor:'ë³¸ê´€ 3ì¸µ', top:'20.5%', left:'20.7%'},
  'ê°€ì •ì˜í•™ê³¼':                {floor:'ë³¸ê´€ 3ì¸µ', top:'21.5%', left:'30.4%'},
  'ì •í˜•ì™¸ê³¼':                  {floor:'ë³¸ê´€ 3ì¸µ', top:'18.8%', left:'46.2%'},
  'ì™¸ê³¼':                      {floor:'ë³¸ê´€ 3ì¸µ', top:'18.8%', left:'68.6%'},
  'ì‹ ì¥ë‚´ê³¼':                  {floor:'ë³¸ê´€ 3ì¸µ', top:'13.7%', left:'82.2%'},
  'ë¥˜ë§ˆí‹°ìŠ¤ ë‚´ê³¼':            {floor:'ë³¸ê´€ 3ì¸µ', top:'30.3%', left:'82.9%'},
  'ì‹ ê²½ê³¼':                    {floor:'ë³¸ê´€ 3ì¸µ', top:'41.5%', left:'84.4%'},
  'ì‹ ê²½ì™¸ê³¼':                  {floor:'ë³¸ê´€ 3ì¸µ', top:'31.3%', left:'75.9%'},
  'ë‹¤í•™ì œí†µí•©ì§„ë£Œ':            {floor:'ë³¸ê´€ 3ì¸µ', top:'41.1%', left:'76.1%'},
  'íŠ¹ìˆ˜ì£¼ì‚¬ì‹¤':                {floor:'ë³¸ê´€ 3ì¸µ', top:'35.4%', left:'63.5%'},
  'ì²™ì¶”ì„¼í„°ì™¸ë˜':              {floor:'ë³¸ê´€ 3ì¸µ', top:'34%', left:'52.3%'},
  'ì£¼ì‚¬ì‹¤':                    {floor:'ë³¸ê´€ 3ì¸µ', top:'33.7%', left:'40.9%'},
  'í˜ˆì•¡ì¢…ì–‘ë‚´ê³¼':              {floor:'ë³¸ê´€ 3ì¸µ', top:'33%', left:'30.6%'},
  'ì•”ì„¼í„° ìƒë‹´ì‹¤':             {floor:'ë³¸ê´€ 3ì¸µ', top:'43.2%', left:'30.4%'},
  'ì˜ë¬´ê¸°ë¡ì˜ìƒë°œê¸‰':          {floor:'ë³¸ê´€ 3ì¸µ', top:'46.5%', left:'23.6%'},
  'í˜¸í¡ê¸°. ì•Œë ˆë¥´ê¸° ê²€ì‚¬ì‹¤':  {floor:'ë³¸ê´€ 3ì¸µ', top:'42.5%', left:'15.3%'},
  'ì•Œë ˆë¥´ê¸° ê°ì—¼ë‚´ê³¼':         {floor:'ë³¸ê´€ 3ì¸µ', top:'57%', left:'11.7%'},
  'í†µì¦í´ë¦¬ë‹‰':                {floor:'ë³¸ê´€ 3ì¸µ', top:'69.6%', left:'7.1%'},
  'ì†Œì•„ì²­ì†Œë…„ê³¼':              {floor:'ë³¸ê´€ 3ì¸µ', top:'71.2%', left:'17.5%'},
  'ì…ì› ì „ ê²€ì‚¬ì‹¤':            {floor:'ë³¸ê´€ 3ì¸µ', top:'70.2%', left:'25.5%'},
  'ì†Œí™”ê¸°ë‚´ê³¼':                {floor:'ë³¸ê´€ 3ì¸µ', top:'70.6%', left:'84.1%'},
  'ê³ ê°ìƒë‹´ì‹¤':                {floor:'ë³¸ê´€ 3ì¸µ', top:'70.2%', left:'92.6%'},

  // ì‹ ê´€ ì§€í•˜ 1ì¸µ
  'í•µì˜í•™ê³¼(pet-ct/ê³¨ë°€ë„)':   {floor:'ì‹ ê´€ ì§€í•˜1ì¸µ', top:'75.7%', left:'42.1%'},

  // ì‹ ê´€ 1ì¸µ
  'ì¢…í•©ê±´ê°•ì§„ë‹¨ì„¼í„°':         {floor:'ì‹ ê´€ 1ì¸µ', top:'35.1%', left:'17%'},
  'ì¢…í•©ê±´ì§„ ct':              {floor:'ì‹ ê´€ 1ì¸µ', top:'47.2%', left:'74.9%'},
  'ê±´ê°•ê´€ë¦¬ì„¼í„°(ê³µë‹¨ê±´ì§„)':   {floor:'ì‹ ê´€ 1ì¸µ', top:'71.3%', left:'47.9%'},

  // ì‹ ê´€ 2ì¸µ
  'í‰ë¶€ì™¸ê³¼':                 {floor:'ì‹ ê´€ 2ì¸µ', top:'30.1%', left:'15.8%'},
  'ì‹¬í˜ˆê´€ì„¼í„° ì™¸ë˜':           {floor:'ì‹ ê´€ 2ì¸µ', top:'32.7%', left:'51.6%'},
  'ì‹¬í˜ˆê´€ì„¼í„° ê²€ì‚¬ì‹¤':         {floor:'ì‹ ê´€ 2ì¸µ', top:'43.1%', left:'74.2%'}, // ì‹¬ì „ë„/ekg/í™€í„°
  'ì‚°ë¶€ì¸ê³¼':                 {floor:'ì‹ ê´€ 2ì¸µ', top:'59.9%', left:'72.5%'},
  'ë‚´ë¶„ë¹„ë‚´ê³¼':               {floor:'ì‹ ê´€ 2ì¸µ', top:'65.5%', left:'55.9%'},

  // ì‹ ê´€ 3ì¸µ
  'ì´ë¹„ì¸í›„ê³¼':               {floor:'ì‹ ê´€ 3ì¸µ', top:'39.1%', left:'35.7%'},
  'ë¹„ë‡¨ì˜í•™ê³¼':               {floor:'ì‹ ê´€ 3ì¸µ', top:'37.8%', left:'55.4%'},
  'ì•ˆê³¼':                     {floor:'ì‹ ê´€ 3ì¸µ', top:'50.3%', left:'70%'},
  'í”¼ë¶€ê³¼':                   {floor:'ì‹ ê´€ 3ì¸µ', top:'50.6%', left:'83.4%'},
  'ì„±í˜•ì™¸ê³¼':                 {floor:'ì‹ ê´€ 3ì¸µ', top:'50.6%', left:'83.4%'},
  'ì¹˜ê³¼':                     {floor:'ì‹ ê´€ 3ì¸µ', top:'57.7%', left:'74.2%'},
  'ì •ì‹ ê±´ê°•ì˜í•™ê³¼':           {floor:'ì‹ ê´€ 3ì¸µ', top:'72.9%', left:'59.8%'},
  'ì§„ë£Œí˜‘ë ¥ì„¼í„°':             {floor:'ì‹ ê´€ 3ì¸µ', top:'79%', left:'34.3%'}
};

/* ---- ë³„ì¹­(ì†Œë¬¸ì ê²€ìƒ‰ í—ˆìš©) ---- */
const aliases = {
  'ct': 'ctì‹¤',
  'ctì‹¤': 'ctì‹¤',
  'mri': 'mriì‹¤',
  'xray': 'ì¼ë°˜ì´¬ì˜ì‹¤',
  'x-ray': 'ì¼ë°˜ì´¬ì˜ì‹¤',
  'ì´ˆìŒíŒŒ': 'ì´ˆìŒíŒŒê²€ì‚¬ì‹¤',
  'ì‹¬ì „ë„': 'ì‹¬í˜ˆê´€ì„¼í„° ê²€ì‚¬ì‹¤',
  'ekg': 'ì‹¬í˜ˆê´€ì„¼í„° ê²€ì‚¬ì‹¤',
  'í™€í„°': 'ì‹¬í˜ˆê´€ì„¼í„° ê²€ì‚¬ì‹¤',
  'ì‹¬ì¥ë‚´ê³¼': 'ì‹¬í˜ˆê´€ì„¼í„° ì™¸ë˜',
  'pet': 'í•µì˜í•™ê³¼(pet-ct/ê³¨ë°€ë„)',
  'pet-ct': 'í•µì˜í•™ê³¼(pet-ct/ê³¨ë°€ë„)',
  'ê³¨ë°€ë„': 'í•µì˜í•™ê³¼(pet-ct/ê³¨ë°€ë„)'
};

/* ---- ì—˜ë¦¬ë¨¼íŠ¸ ìºì‹± ---- */
const startInput = document.getElementById('startInput');
const endInput = document.getElementById('endInput');
const searchInput = document.getElementById('searchInput');

const startSuggestBox = document.getElementById('startSuggest');
const endSuggestBox   = document.getElementById('endSuggest');
const searchSuggestBox= document.getElementById('searchSuggest');

const startSuggestList = document.getElementById('startSuggestList');
const endSuggestList   = document.getElementById('endSuggestList');
const searchSuggestList= document.getElementById('searchSuggestList');

const mapsContainer    = document.getElementById('mapsContainer');
const currentBlock     = document.getElementById('currentBlock');
const destBlock        = document.getElementById('destBlock');
const mapCurrentWrap   = document.getElementById('mapCurrent');
const mapDestWrap      = document.getElementById('mapDestination');
const mapImageCurrent  = document.getElementById('mapImageCurrent');
const mapImageDest     = document.getElementById('mapImageDestination');
const messageBox       = document.getElementById('message');

const loadingOverlay   = document.getElementById('loadingOverlay');

/* ---- ìœ í‹¸: í‘œì¤€í™” ---- */
function norm(str){
  return str.toLowerCase().replace(/\s+/g,'');
}

/* ---- ì¶”ì²œì–´ ë¦¬ìŠ¤íŠ¸ ìƒì„± ---- */
function getSuggestions(query){
  if(!query) return [];
  const q = norm(query);

  let aliasMatches = [];
  Object.keys(aliases).forEach(aKey=>{
    if(norm(aKey).includes(q)){
      const realName = aliases[aKey];
      if(positions[realName]){
        aliasMatches.push(realName);
      }
    }
  });

  let directMatches = [];
  Object.keys(positions).forEach(pKey=>{
    if(norm(pKey).includes(q)){
      directMatches.push(pKey);
    }
  });

  const merged=[...aliasMatches,...directMatches];
  const unique=[...new Set(merged)];
  return unique.slice(0,5).map(name=>{
    const {floor}=positions[name];
    return {name, floor};
  });
}

/* ---- ì¶”ì²œ ë°•ìŠ¤ ë Œë” ---- */
function fillSuggestions(listEl, boxEl, suggestions, targetInput){
  listEl.innerHTML='';
  if(suggestions.length===0){
    boxEl.style.display='none';
    return;
  }
  suggestions.forEach(sug=>{
    const div=document.createElement('div');
    div.className='suggest-item';
    div.innerHTML=`<b>${sug.name}</b><small>${sug.floor}</small>`;
    div.onclick=()=>{
      targetInput.value=sug.name;
      boxEl.style.display='none';
    };
    listEl.appendChild(div);
  });
  boxEl.style.display='block';
}

function showSuggestions(type){
  if(type==='start'){
    fillSuggestions(
      startSuggestList,
      startSuggestBox,
      getSuggestions(startInput.value),
      startInput
    );
  }else if(type==='end'){
    fillSuggestions(
      endSuggestList,
      endSuggestBox,
      getSuggestions(endInput.value),
      endInput
    );
  }else if(type==='search'){
    fillSuggestions(
      searchSuggestList,
      searchSuggestBox,
      getSuggestions(searchInput.value),
      searchInput
    );
  }
}

/* ---- ë°”ê¹¥ í´ë¦­ ì‹œ ì¶”ì²œì°½ ë‹«ê¸° ---- */
document.addEventListener('click',(e)=>{
  const inStart=e.target.closest('#startSuggest')||e.target.closest('#startInput');
  if(!inStart){startSuggestBox.style.display='none';}

  const inEnd=e.target.closest('#endSuggest')||e.target.closest('#endInput');
  if(!inEnd){endSuggestBox.style.display='none';}

  const inSearch=e.target.closest('#searchSuggest')||e.target.closest('#searchInput');
  if(!inSearch){searchSuggestBox.style.display='none';}
});

/* ---- ë³„ì¹­ í¬í•¨ ê²€ìƒ‰ í‚¤ ë§¤ì¹­ ---- */
function resolveKey(raw){
  if(!raw) return null;
  const lowered=raw.trim().toLowerCase();
  const aliased=aliases[lowered] ? aliases[lowered] : lowered;
  const match=Object.keys(positions).find(k =>
    k.toLowerCase().includes(aliased)
  );
  return match||null;
}

/* ---- ë§ˆì»¤ ì¶”ê°€ ---- */
function addMarker(wrapper, cls, top, left){
  const m=document.createElement('div');
  m.className='marker '+cls;
  m.style.top=top;
  m.style.left=left;
  wrapper.appendChild(m);
}

/* ---- ì§€ë„ ì„¸íŒ… ---- */
function setupMap(wrapper, imgEl, floorName){
  wrapper.querySelectorAll('.marker').forEach(n=>n.remove());
  imgEl.src=maps[floorName];
  imgEl.dataset.floorName=floorName;
}

/* ---- ë¡œë”© ì˜¤ë²„ë ˆì´ ì œì–´ ---- */
function showLoading(){
  loadingOverlay.style.display='flex';
}
function hideLoading(){
  loadingOverlay.style.display='none';
}

/* ì´ë¯¸ì§€ ë‘ ì¥(or í•œ ì¥) ëª¨ë‘ ë¡œë“œ ì™„ë£Œ í›„ì—ë§Œ hideLoading */
function waitImagesLoaded(imgEls, callback){
  let remain = imgEls.length;
  function done(){
    remain -= 1;
    if(remain<=0){
      callback();
    }
  }
  imgEls.forEach(imgEl=>{
    if(!imgEl || !imgEl.src){
      // src ì—†ìœ¼ë©´ ë°”ë¡œ ì™„ë£Œë¡œ ì¹´ìš´íŠ¸
      done();
      return;
    }
    if(imgEl.complete){
      // ì´ë¯¸ ë¡œë“œëœ ìƒíƒœ
      done();
    }else{
      imgEl.onload = done;
      imgEl.onerror = done;
    }
  });
}

/* ---- ë¹ ë¥¸ ìœ„ì¹˜ ì°¾ê¸° (ë„ì°©ì§€ë§Œ) ---- */
function searchPlace(){
  const raw=searchInput.value.trim();
  if(!raw){
    messageBox.textContent='ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
    messageBox.style.color='#d9534f';
    mapsContainer.style.display='none';
    return;
  }

  const key=resolveKey(raw);
  if(!key){
    messageBox.textContent='ì¼ì¹˜í•˜ëŠ” ì¥ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
    messageBox.style.color='#d9534f';
    mapsContainer.style.display='none';
    return;
  }

  const dst=positions[key];

  // ë¡œë”© ì‹œì‘
  showLoading();

  // ì§€ë„ êµ¬ì„±: "ë„ì°©ì§€ë§Œ" ë³´ì—¬ì¤˜ì•¼ í•˜ë¯€ë¡œ
  // - currentBlock ìˆ¨ê¹€
  // - destBlockë§Œ í‘œì‹œ
  currentBlock.style.display='none';
  destBlock.style.display='block';
  mapsContainer.style.display='block';

  // ë„ì°©ì¸µ ì§€ë„ë§Œ ì„¸íŒ…
  setupMap(mapDestWrap, mapImageDestination, dst.floor);

  // ë„ì°© ë§ˆì»¤
  addMarker(mapDestWrap,'end',dst.top,dst.left);

  // ë©”ì‹œì§€
  messageBox.textContent=
    `${dst.floor} ${key} ìœ„ì¹˜ê°€ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.\nì£¼í™©ìƒ‰ ì ì´ ë„ì°©ì§€ì˜ˆìš”.\nì§€ë„ë¥¼ ëˆ„ë¥´ë©´ í¬ê²Œ ë³¼ ìˆ˜ ìˆì–´ìš” ğŸ–±ï¸`;
  messageBox.style.color='#009688';

  // ì´ë¯¸ì§€ ë¡œë”© ëë‚˜ë©´ ë¡œë”©íŒì—… ë‹«ê¸°
  waitImagesLoaded([mapImageDestination], hideLoading);
}

/* ---- ê²½ë¡œ ì•ˆë‚´ (ì¶œë°œì§€ â†’ ë„ì°©ì§€) ---- */
function navigateRoute(){
  const sVal=startInput.value.trim();
  const eVal=endInput.value.trim();

  if(!eVal){
    messageBox.textContent='ë„ì°©ì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
    messageBox.style.color='#d9534f';
    mapsContainer.style.display='none';
    return;
  }

  const startKey=resolveKey(sVal);
  const endKey=resolveKey(eVal);

  if(!endKey){
    messageBox.textContent='ë„ì°©ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
    messageBox.style.color='#d9534f';
    mapsContainer.style.display='none';
    return;
  }

  const src=startKey?positions[startKey]:null;
  const dst=positions[endKey];

  const srcFloor=src?src.floor:null;
  const dstFloor=dst.floor;

  // ë¡œë”© ì‹œì‘
  showLoading();

  // ê²½ë¡œ ì•ˆë‚´ ì‹œì—ëŠ” ì¶œë°œì¸µ+ë„ì°©ì¸µ ëª¨ë‘ ë³´ì—¬ì¤Œ
  currentBlock.style.display='block';
  destBlock.style.display='block';
  mapsContainer.style.display='block';

  // ìœ„ ì§€ë„(ì¶œë°œì¸µ ë˜ëŠ” fallback)
  const currentFloorToShow = srcFloor || dstFloor;
  setupMap(mapCurrentWrap, mapImageCurrent, currentFloorToShow);

  // ì•„ë˜ ì§€ë„(ë„ì°©ì¸µ)
  setupMap(mapDestWrap, mapImageDestination, dstFloor);

  // ì¶œë°œì§€ ë§ˆì»¤(ì´ˆë¡)
  if(src){
    addMarker(mapCurrentWrap,'start',src.top,src.left);
  }

  // ì—˜ë¦¬ë² ì´í„°(êµ¬ë¦¬ìƒ‰) - ì¶œë°œì¸µ ê¸°ì¤€
  const elevInfo=elevators[currentFloorToShow];
  if(elevInfo){
    addMarker(mapCurrentWrap,'elevator',elevInfo.top,elevInfo.left);
  }

  // ë„ì°©ì§€(ì£¼í™©)
  addMarker(mapDestWrap,'end',dst.top,dst.left);

  // ì•ˆë‚´ ë¬¸êµ¬ ë§Œë“¤ê¸°
  const srcBuilding = srcFloor ? (srcFloor.includes('ë³¸ê´€')?'ë³¸ê´€':'ì‹ ê´€') : null;
  const dstBuilding = dstFloor.includes('ë³¸ê´€')?'ë³¸ê´€':'ì‹ ê´€';
  const sameBuilding = (srcBuilding && srcBuilding===dstBuilding);
  const sameFloor    = (srcFloor && srcFloor===dstFloor);

  let text='';
  if(src){
    text += `${srcFloor} ${startKey} â†’ ${dstFloor} ${endKey}ë¡œ ì´ë™í•©ë‹ˆë‹¤ ğŸ™‚\n`;
  }else{
    text += `${dstFloor} ${endKey} ìœ„ì¹˜ë¥¼ í‘œì‹œí–ˆìŠµë‹ˆë‹¤ ğŸ™‚\n`;
  }

  if(!src){
    text += `ì£¼í™©ìƒ‰ ì ì´ ë„ì°©ì§€ì˜ˆìš”.\nì§€ë„ë¥¼ ëˆ„ë¥´ë©´ í¬ê²Œ ë³¼ ìˆ˜ ìˆì–´ìš” ğŸ–±ï¸`;
  }else if(sameBuilding && sameFloor){
    text += `ê°™ì€ ì¸µì´ë¯€ë¡œ ë°”ë¡œ ì´ë™í•˜ì‹œë©´ ë©ë‹ˆë‹¤ ğŸ™‚\nì¶œë°œì§€ëŠ” ì´ˆë¡ìƒ‰, ë„ì°©ì§€ëŠ” ì£¼í™©ìƒ‰ìœ¼ë¡œ í‘œì‹œë¼ìš”.\nì§€ë„ë¥¼ ëˆ„ë¥´ë©´ í¬ê²Œ ë³¼ ìˆ˜ ìˆì–´ìš” ğŸ–±ï¸`;
  }else if(sameBuilding && !sameFloor){
    text += `ê°™ì€ ê±´ë¬¼ì´ì§€ë§Œ ì¸µì´ ë‹¬ë¼ìš”.\n${srcFloor}ì—ì„œ ì—˜ë¦¬ë² ì´í„°(êµ¬ë¦¬ìƒ‰ ì )ë¥¼ íƒ€ê³  ${dstFloor}ìœ¼ë¡œ ì´ë™í•´ì£¼ì„¸ìš” ğŸšª`;
  }else{
    text += `ê±´ë¬¼ì´ ë‹¤ë¦…ë‹ˆë‹¤.\në³¸ê´€ê³¼ ì‹ ê´€ì€ 2ì¸µ ë˜ëŠ” 3ì¸µ ì—°ê²°í†µë¡œë¥¼ ì´ìš©í•˜ì‹œë©´ ë©ë‹ˆë‹¤ ğŸš¶â€â™€ï¸`;
  }

  messageBox.textContent=text;
  messageBox.style.color='#009688';

  // ë‘ ì¥ ë‹¤ ë¡œë”© ëë‚˜ë©´ ë¡œë”©íŒì—… ë‹«ê¸°
  waitImagesLoaded([mapImageCurrent,mapImageDestination], hideLoading);
}

/* ---- ì´ë¯¸ì§€ íŒì—… ---- */
function openImagePopup(src){
  const pop = document.getElementById('imagePopup');
  const img = document.getElementById('popupImg');
  const marker = document.getElementById('popupMarker');

  // ì´ë¯¸ì§€ ê²½ë¡œ ì§€ì •
  img.src = src;

  // ë„ì°©ì§€ ì§€ë„ì—ì„œ ì£¼í™©ìƒ‰ ë§ˆì»¤ë¥¼ ì°¾ì•„ì„œ íŒì—…ì—ë„ ë™ì¼í•˜ê²Œ í‘œì‹œ
  const destMarker = mapDestWrap.querySelector('.marker.end');
  if(destMarker){
    const topPct = destMarker.style.top;
    const leftPct = destMarker.style.left;
    marker.style.top = topPct;
    marker.style.left = leftPct;
    marker.style.display = 'block';
  } else {
    marker.style.display = 'none';
  }

  pop.style.display = 'flex';
}

function closeImagePopup(){
  document.getElementById('imagePopup').style.display = 'none';
}

document.getElementById('imagePopup').addEventListener('click', (e) => {
  const inner = document.getElementById('popupInner');
  if(!inner.contains(e.target)){
    closeImagePopup();
  }
});

/* ---- ê´€ë¦¬ì ëª¨ë“œ (Alt+M) ---- */
let adminMode=false;
document.addEventListener('keydown',e=>{
  if(e.altKey && e.key==='m'){
    toggleAdminMode();
  }
});
function toggleAdminMode(){
  if(!adminMode){
    const pw=prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
    if(pw!=="gnah2025"){
      alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      return;
    }
    adminMode=true;
    alert("ğŸ› ï¸ ê´€ë¦¬ì ëª¨ë“œ í™œì„±í™”\n(ì•„ë˜ ì§€ë„)ë¥¼ í´ë¦­í•˜ë©´ ì¢Œí‘œë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
    mapDestWrap.addEventListener('click',handleAdminClick);
  }else{
    adminMode=false;
    alert("ê´€ë¦¬ì ëª¨ë“œ ì¢…ë£Œ");
    mapDestWrap.removeEventListener('click',handleAdminClick);
  }
}
function handleAdminClick(e){
  if(!adminMode)return;
  const rect=mapImageDestination.getBoundingClientRect();
  const xPct=((e.clientX-rect.left)/rect.width)*100;
  const yPct=((e.clientY-rect.top)/rect.height)*100;
  const floorGuess=mapImageDestination.dataset.floorName||'';
  const label=prompt(
    `ì´ ìœ„ì¹˜ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.\nì¢Œí‘œ: top:${yPct.toFixed(1)}%, left:${xPct.toFixed(1)}%\nì¸µ: ${floorGuess}`
  );
  if(!label)return;
  const finalFloor=floorGuess||prompt("ì¸µ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ë³¸ê´€ 2ì¸µ)");
  positions[label]={
    floor:finalFloor,
    top:yPct.toFixed(1)+'%',
    left:xPct.toFixed(1)+'%'
  };
  console.log("âœ… ìƒˆ ìœ„ì¹˜ ì¶”ê°€:",label,positions[label]);
  alert(`${finalFloor} ${label} ì¶”ê°€ ì™„ë£Œ!\n(F12 ì½˜ì†”ì—ì„œ í™•ì¸ ê°€ëŠ¥)`);
}

/* ---- ì‚¬ì „ í”„ë¦¬ìºì‹œ (ì†ë„ í–¥ìƒ) ---- */
(function precacheAll(){
  Object.values(maps).forEach(url=>{
    const img=new Image();
    img.src=url;
  });
})();
</script>

</body>
</html>

